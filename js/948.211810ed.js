"use strict";(self["webpackChunkvue_shopping"]=self["webpackChunkvue_shopping"]||[]).push([[948],{4247:function(s,t,a){a.r(t),a.d(t,{default:function(){return p}});a(7658);var e=function(){var s=this,t=s._self._c;return t("div",{staticClass:"pay"},[t("van-nav-bar",{attrs:{fixed:"",title:"订单结算台","left-arrow":""},on:{"click-left":function(t){return s.$router.go(-1)}}}),t("div",{staticClass:"address",on:{click:function(t){return s.$router.push("/myAddress")}}},[t("div",{staticClass:"left-icon"},[t("van-icon",{attrs:{name:"logistics"}})],1),s.addressList.address_id?t("div",{staticClass:"info"},[t("div",{staticClass:"info-content"},[t("span",{staticClass:"name"},[s._v(s._s(s.selectAddress.name)+" - ")]),t("span"),t("span",{staticClass:"mobile"},[s._v(s._s(s.selectAddress.phone)+" ")])]),t("div",{staticClass:"info-address"},[s._v(" "+s._s(s.longAddress)+" "+s._s(s.selectAddress.detail)+" ")])]):t("div",{staticClass:"empty-address"},[t("div",{staticClass:"tips"},[s._v(" 您还没有设置收货地址哦，快去设置吧 ")]),t("div",{staticClass:"btn",on:{click:function(t){return s.$router.push("/newAddress")}}},[s._v("添加地址")])]),t("div",{staticClass:"right-icon"},[t("van-icon",{attrs:{name:"arrow"}})],1)]),t("div",{staticClass:"pay-list"},[t("div",{staticClass:"list"},s._l(s.shopList,(function(a){return t("div",{key:a.goods_id,staticClass:"goods-item"},[t("div",{staticClass:"left"},[t("img",{attrs:{src:a.goods_image,alt:""}})]),t("div",{staticClass:"right"},[t("p",{staticClass:"tit text-ellipsis-2"},[s._v(" "+s._s(a.goods_name)+" ")]),t("p",{staticClass:"info"},[t("span",{staticClass:"count"},[s._v("x"+s._s(a.total_num))]),t("span",{staticClass:"price"},[s._v("¥"+s._s(a.goods_price_min))])])])])})),0),t("div",{staticClass:"flow-num-box"},[t("span",[s._v("共 "+s._s(s.total.orderTotalNum)+" 件商品，合计：")]),t("span",{staticClass:"money"},[s._v("￥"+s._s(s.total.orderTotalPrice))])]),t("div",{staticClass:"pay-detail"},[t("div",{staticClass:"pay-cell"},[t("span",[s._v("订单总金额：")]),t("span",{staticClass:"red"},[s._v("￥"+s._s(s.total.orderTotalPrice))])]),s._m(0),t("div",{staticClass:"pay-cell"},[t("span",[s._v("配送费用：")]),t("span",{staticClass:"red"},[s._v("+￥0.00")])])]),t("div",{staticClass:"pay-way"},[t("span",{staticClass:"tit"},[s._v("支付方式")]),t("div",{staticClass:"pay-cell"},[t("span",[t("van-icon",{attrs:{name:"balance-o"}}),s._v("余额支付（可用 ¥ "+s._s(s.person)+" 元）")],1),t("span",{staticClass:"red"},[t("van-icon",{attrs:{name:"passed"}})],1)])]),t("div",{staticClass:"buytips"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:s.remark,expression:"remark"}],attrs:{placeholder:"选填：买家留言（50字内）",name:"",id:"",cols:"30",rows:"10"},domProps:{value:s.remark},on:{input:function(t){t.target.composing||(s.remark=t.target.value)}}})])]),t("div",{staticClass:"footer-fixed"},[t("div",{staticClass:"left"},[s._v("实付款："),t("span",[s._v("￥"+s._s(s.total.orderTotalPrice))])]),t("div",{staticClass:"tipsbtn",on:{click:s.buyOrder}},[s._v("提交订单")])])],1)},r=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"pay-cell"},[t("span",[s._v("优惠券：")]),t("span",[s._v("无优惠券可用")])])}],i=(a(6743),a(8848)),d=a(170),o=a(7535),n={name:"PayIndex",data(){return{remark:"请留言",addressList:{},shopList:[],total:{},person:{}}},created(){this.getAddressList(),this.getOrderList()},computed:{longAddress(){const s=this.selectAddress.region;return Object.values(s||{}).join(" ")},selectAddress(){return this.addressList},mode(){return this.$route.query.mode},cartIds(){return this.$route.query.cartIds},goodsId(){return this.$route.query.goodsId},goodsNum(){return this.$route.query.goodsNum},goodsSkuId(){return this.$route.query.goodsSkuId}},methods:{async getAddressList(){const{data:{list:s}}=await(0,d.zM)(),{data:{defaultId:t}}=await(0,d.ID)(),a=s.find((s=>s.address_id===t));console.log(a),this.addressList=a||{}},async getOrderList(){if("cart"===this.mode){const s=await(0,o.Xd)(this.mode,{cartIds:this.cartIds}),{data:t}=s,{data:{order:{orderTotalNum:a,orderTotalPrice:e},personal:r}}=s;this.shopList=t.order.goodsList,this.total={orderTotalNum:a,orderTotalPrice:e},this.person=r.balance}else{const s=await(0,o.Xd)(this.mode,{goodsId:this.goodsId,goodsNum:this.goodsNum,goodsSkuId:this.goodsSkuId}),{data:t}=s,{data:{order:{orderTotalNum:a,orderTotalPrice:e},personal:r}}=s;this.shopList=t.order.goodsList,this.total={orderTotalNum:a,orderTotalPrice:e},this.person=r.balance}},async buyOrder(){if(this.addressList.address_id){if("cart"===this.mode){const s=await(0,o.ir)(this.mode,{cartIds:this.cartIds,remark:this.remark});console.log(s)}else{const s=await(0,o.ir)(this.mode,{goodsId:this.goodsId,goodsNum:this.goodsNum,goodsSkuId:this.goodsSkuId,remark:this.remark});console.log(s)}this.$toast.allowMultiple(),this.$toast.loading({message:"加载中...",forbidClick:!0,duration:500}),await this.$sleep(500),this.$toast.success("支付成功"),await this.$sleep(1e3),this.$router.replace("/myorder")}else i.Z.fail("请选择收货地址")}}},l=n,c=a(1001),u=(0,c.Z)(l,e,r,!1,null,"670b4d70",null),p=u.exports},170:function(s,t,a){a.d(t,{EY:function(){return d},GI:function(){return l},ID:function(){return u},NW:function(){return c},bM:function(){return i},gh:function(){return o},n5:function(){return n},zM:function(){return r}});var e=a(4471);const r=()=>e.Z.get("/address/list"),i=s=>e.Z.get("/address/detail",{params:{addressId:s}}),d=(s,t,a,r)=>e.Z.post("/address/add",{form:{name:s,phone:t,region:a,detail:r}}),o=(s,t,a,r,i)=>e.Z.post("/address/edit",{addressId:s,form:{name:t,phone:a,region:r,detail:i}}),n=s=>e.Z.post("/address/remove",{addressId:s}),l=()=>e.Z.get("/region/tree"),c=s=>e.Z.post("/address/setDefault",{addressId:s}),u=()=>e.Z.get("/address/defaultId")}}]);
//# sourceMappingURL=948.211810ed.js.map