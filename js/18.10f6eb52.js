"use strict";(self["webpackChunkvue_shopping"]=self["webpackChunkvue_shopping"]||[]).push([[18],{1018:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login"},[t("van-nav-bar",{attrs:{title:"会员登录","left-arrow":""},on:{"click-left":function(t){return e.$router.go(-1)}}}),t("div",{staticClass:"container"},[e._m(0),t("div",{staticClass:"form"},[t("div",{staticClass:"form-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.phoneNumber,expression:"phoneNumber"}],staticClass:"inp",attrs:{maxlength:"11",placeholder:"请输入手机号码",type:"text"},domProps:{value:e.phoneNumber},on:{input:function(t){t.target.composing||(e.phoneNumber=t.target.value)}}})]),t("div",{staticClass:"form-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.picCode,expression:"picCode"}],staticClass:"inp",attrs:{maxlength:"5",placeholder:"请输入图形验证码",type:"text"},domProps:{value:e.picCode},on:{input:function(t){t.target.composing||(e.picCode=t.target.value)}}}),t("img",{directives:[{name:"show",rawName:"v-show",value:e.picUrl,expression:"picUrl"}],attrs:{src:e.picUrl,alt:""},on:{click:function(t){return e.getPicCode()}}})]),t("div",{staticClass:"form-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.SMScode,expression:"SMScode"}],staticClass:"inp",attrs:{placeholder:"请输入短信验证码",type:"text"},domProps:{value:e.SMScode},on:{input:function(t){t.target.composing||(e.SMScode=t.target.value)}}}),t("button",{ref:"btnCode",on:{click:function(t){return e.getCode()}}},[e._v(e._s(e.times===e.setTime?"获取验证码":e.times+"秒后重新发送"))])])]),t("div",{staticClass:"login-btn",on:{click:function(t){return e.loginFn()}}},[e._v("登录")])])],1)},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("p",[e._v("未注册的手机号登录后将自动注册")])])}],o=(i(6743),i(8848)),n=i(4471);const r=()=>n.Z.get("/captcha/image"),c=(e,t,i)=>n.Z.post("/captcha/sendSmsCaptcha",{form:{captchaCode:e,captchaKey:t,mobile:i}}),l=(e,t)=>n.Z.post("/passport/login",{form:{isParty:!1,mobile:e,partyData:{},smsCode:t}});var d={name:"LoginPage",data(){return{setTime:50,times:50,timerId:null,phoneNumber:"",SMScode:"",picCode:"",picKey:"",picUrl:""}},methods:{async getPicCode(){const{data:{base64:e,key:t}}=await r();this.picUrl=e,this.picKey=t},codeFn(){const e=/^1\d{10}$/g,t=/^[a-zA-Z0-9]{4}$/g;return e.test(this.phoneNumber)?!!t.test(this.picCode)||(o.Z.fail("请输入正确的图形验证码"),!1):(o.Z.fail("请输入11位的手机号"),!1)},async getCode(){if(this.codeFn())if(this.timerId||this.setTime!==this.times)o.Z.fail("请输入11位的手机号");else{const e=await c(this.picCode,this.picKey,this.phoneNumber);if(200!==e.status)return o.Z.fail(e.message),await this.$sleep(500),void this.getPicCode();o.Z.success("验证码发送成功：246810"),this.$refs.btnCode.disabled=!0,this.timerId=setInterval((()=>{this.times--,this.times<=0&&(clearInterval(this.timerId),this.timerId=null,this.times=this.setTime,this.$refs.btnCode.disabled=!1)}),1e3)}},async loginFn(){if(!this.codeFn())return;const e=/^[0-9]{6}$/g;if(!e.test(this.SMScode))return void o.Z.fail("请输入正确格式的短信验证码");o.Z.success("登录成功"),await this.$sleep(1e3);const t=await l(this.phoneNumber,this.SMScode);this.$store.commit("user/getUserInfo",t.data);const i=this.$route.query.backUrl||"/";this.$router.replace(i)}},created(){this.getPicCode()},mounted(){},update(){},destroyed(){clearInterval(this.timerId)}},p=d,m=i(1001),u=(0,m.Z)(p,s,a,!1,null,"745647f4",null),h=u.exports}}]);
//# sourceMappingURL=18.10f6eb52.js.map